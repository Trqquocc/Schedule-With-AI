
<div id="aiSuggestionModal" class="modal hidden">

  <div
    class="modal-overlay"
    onclick="ModalManager.hideModalById('aiSuggestionModal')"
  ></div>

  <div class="modal-content">

    <div class="ai-modal-header">
      <div class="modal-header-left">
        <div class="modal-icon">
          <i class="fas fa-robot"></i>
        </div>
        <div class="modal-title">
          <h3>T·∫°o L·ªãch Tr√¨nh Th√¥ng Minh</h3>
          <p class="modal-subtitle">AI s·∫Ω s·∫Øp x·∫øp c√¥ng vi·ªác t·ªëi ∆∞u cho b·∫°n</p>
        </div>
      </div>
      <button
        class="modal-close"
        onclick="ModalManager.hideModalById('aiSuggestionModal')"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="ai-modal-body">

      <form id="aiSuggestionForm">

        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-calendar-alt"></i>
            <span>Ch·ªçn Kho·∫£ng Th·ªùi Gian</span>
          </div>
          <div class="date-range-grid">
            <div class="form-group">
              <label class="form-label">T·ª´ ng√†y</label>
              <input type="date" id="aiStartDate" class="date-input" required />
            </div>
            <div class="form-group">
              <label class="form-label">ƒê·∫øn ng√†y</label>
              <input type="date" id="aiEndDate" class="date-input" required />
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="section-header">
            <div class="section-title">
              <i class="fas fa-tasks"></i>
              <span>Ch·ªçn C√¥ng Vi·ªác</span>
            </div>
            <button type="button" class="btn-select-all" id="selectAllTasksBtn">
              <i class="fas fa-check-double"></i>
              <span>Ch·ªçn t·∫•t c·∫£</span>
            </button>
          </div>

          <div class="task-list-container">
            <div class="task-list" id="aiTaskList">

              <div class="loading-state">
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                </div>
                <p>ƒêang t·∫£i c√¥ng vi·ªác...</p>
              </div>
            </div>

            <div class="task-stats" id="aiTaskStats">
              ƒê√£ ch·ªçn: <strong>0</strong> c√¥ng vi·ªác
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-sliders-h"></i>
            <span>T√πy Ch·ªçn AI</span>
          </div>

          <div class="ai-options-grid">

            <label class="ai-option">
              <input type="checkbox" id="aiOptionAvoidConflict" checked />
              <div class="option-content">
                <div class="option-icon">
                  <i class="fas fa-shield-alt"></i>
                </div>
                <div class="option-text">
                  <strong>Tr√°nh tr√πng l·ªãch</strong>
                  <small>Kh√¥ng x·∫øp v√†o khung gi·ªù ƒë√£ c√≥</small>
                </div>
              </div>
            </label>

            <label class="ai-option">
              <input type="checkbox" id="aiOptionConsiderPriority" checked />
              <div class="option-content">
                <div class="option-icon">
                  <i class="fas fa-star"></i>
                </div>
                <div class="option-text">
                  <strong>∆Øu ti√™n quan tr·ªçng</strong>
                  <small>X·∫øp vi·ªác quan tr·ªçng tr∆∞·ªõc</small>
                </div>
              </div>
            </label>

            <label class="ai-option">
              <input type="checkbox" id="aiOptionBalanceWorkload" checked />
              <div class="option-content">
                <div class="option-icon">
                  <i class="fas fa-balance-scale"></i>
                </div>
                <div class="option-text">
                  <strong>C√¢n b·∫±ng kh·ªëi l∆∞·ª£ng</strong>
                  <small>Ph√¢n ƒë·ªÅu c√¥ng vi·ªác c√°c ng√†y</small>
                </div>
              </div>
            </label>
          </div>
        </div>
      </form>
    </div>

    <div class="ai-modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        onclick="ModalManager.hideModalById('aiSuggestionModal')"
      >
        <i class="fas fa-times"></i>
        <span>ƒê√≥ng</span>
      </button>
      <button
        type="button"
        class="btn btn-primary"
        id="aiSubmitBtn"
        onclick="if (window.AIHandler && AIHandler.handleFormSubmitAction) { AIHandler.handleFormSubmitAction(); }"
      >
        <i class="fas fa-magic"></i>
        <span>T·∫°o L·ªãch Tr√¨nh</span>
      </button>
    </div>
  </div>
</div>

<script>
  console.log(" AI Modal Script - Enhanced Integration v2.0");

  // Enhanced handler for modal initialization - using global events
  (function () {
    // Initialize when modal is shown via ModalManager
    async function initializeAIModal() {
      console.log(" Initializing AI modal...");

      try {
        // Wait for AIHandler to be available
        if (!window.AIHandler) {
          await new Promise((resolve) => {
            const checkInterval = setInterval(() => {
              if (window.AIHandler) {
                clearInterval(checkInterval);
                resolve();
              }
            }, 100);
            setTimeout(() => clearInterval(checkInterval), 5000);
          });
        }

        // Call AIHandler to initialize and populate modal
        if (window.AIHandler && window.AIHandler.initAIModal) {
          console.log(" Calling AIHandler.initAIModal...");
          await AIHandler.initAIModal();
          console.log(" Modal initialized and populated");
        } else {
          console.error(" AIHandler.initAIModal not available");
        }
      } catch (error) {
        console.error(" Error initializing AI modal:", error);
      }
    }

    // Listen for modalOpened event from ModalManager
    window.addEventListener("modalOpened", (e) => {
      if (e.detail && e.detail.modalId === "aiSuggestionModal") {
        console.log("üéØ AI Modal opened via ModalManager, initializing...");
        setTimeout(initializeAIModal, 300);
      }
    });

    // Expose for manual calls if needed
    window.initializeAIModal = initializeAIModal;

    console.log(" AI Modal Event Listener ready");
  })();
</script>
